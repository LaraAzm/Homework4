[
  {
    "objectID": "Homework4.html",
    "href": "Homework4.html",
    "title": "ST558 - Homework 4: Hodge podging with purrr",
    "section": "",
    "text": "library(httr)\nlibrary(jsonlite)\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter()  masks stats::filter()\n✖ purrr::flatten() masks jsonlite::flatten()\n✖ dplyr::lag()     masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n\n\nTask 1: Conceptual Questions\n\nWhat is the purpose of the lapply() function? What is the equivalent purrr function?\n\n\nlapply() applies a given function to a list\n\n\nSuppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = “kendall”) on each element of the list. Write code to do this below! (I’m really trying to ask you how you specify method = \"kendall\" when calling lapply()).\n\n\nlapply(X = my_list, FUN = function(x) {cor(x, method = \"kendall\")})\n\n\nWhat are two advantages of using purrr functions instead of the BaseR apply family?\n\n\nType stable functions and first argument is always the data\n\n\nWhat is a side-effect function?\n\n\nDoes something other than return a value\n\n\nWhy can you name a variable sd in a function and not cause any issues with the sd function?\n\n\nThe function exists in a different namespace than the variable\n\n\n\nTask 2: Writing R Functions\n\n#setting up trial data to test function\nset.seed(5)\nn &lt;- 50\nx &lt;- runif(n)\nresponse &lt;- 2 + 10*x + rnorm(n)\npredict &lt;- predict(lm(response ~ x), data.frame(x))\n\n\n#running basic computation for RMSE that I will later put into the function, also getting an idea of the value\nsqrt(mean((response - predict)^2))\n\n[1] 0.9643126\n\n\n\n#creating a function to run the RMSE computation\ngetRMSE &lt;- function(x, y, ...){\n  stat &lt;- sqrt(mean((x - y)^2, ...))\n  return(stat = stat)\n}\n\n\n#testing the function\ngetRMSE(response, predict)\n\n[1] 0.9643126\n\n\n\n#creating objects from task 1, #2\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp2 &lt;- 3 + 10*x + rnorm(n)\npred2 &lt;- predict(lm(resp2 ~ x), data.frame(x))\n\n\n#finding the correct results first \nsqrt(mean((resp2 - pred2)^2))\n\n[1] 0.9581677\n\n\n\n#running the RMSE function and comparing it to previous results\ngetRMSE(resp2, pred2)\n\n[1] 0.9581677\n\n\n\n#adding NA values to the data \nresp2[55:56] &lt;- NA_real_\n\n#running RMSE function without specifying NA values\ngetRMSE(resp2, pred2)\n\n[1] NA\n\n#testing the additional arguments by specifying the NA values \ngetRMSE(resp2, pred2, na.rm = TRUE)\n\n[1] 0.9650897\n\n\n\n#repeating computation step with MAE \nabs(mean(response - predict))\n\n[1] 1.949612e-15\n\n\n\n#creating a function for MAE\ngetMAE &lt;- function(x, y, ...){\n  stat &lt;- abs(mean(x - y, ...))\n  return(stat)\n}\n\n\n#testing the function\ngetMAE(response, predict)\n\n[1] 1.949612e-15\n\n\n\n#Task 2, #4 data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp4 &lt;- 3 + 10*x + rnorm(n)\npred4 &lt;- predict(lm(resp4 ~ x), data.frame(x))\n\n\n#finding the correct results first \nabs(mean(resp4 - pred4))\n\n[1] 9.636992e-16\n\n\n\n#running the MAE function \ngetMAE(resp4, pred4)\n\n[1] 9.636992e-16\n\n\n\n#adding NA values to the data \nresp4[42:43] &lt;- NA_real_\n\n#running the MAE function without specifying NA values\ngetMAE(resp4, pred4)\n\n[1] NA\n\n#testing the additional arguments by specifying the NA values \ngetMAE(resp4, pred4, na.rm = TRUE)\n\n[1] 0.000705427\n\n\n\nstat_wrapper &lt;- function(x, y, ...){\n  if(!(is.vector(x) & is.atomic(x) & is.numeric(x))){\n    stop(\"Response variable is invalid\")\n  }\n  if(!(is.vector(y) & is.atomic(y) & is.numeric(y))){\n    stop(\"Predictor variable is invalid\")\n  }\n  Stats &lt;- list()\n  Stats$RMSE &lt;- getRMSE(x, y, ...)\n  Stats$MAE &lt;- getMAE(x, y, ...)\n  return(Stats)\n}\n\n\n#Task 2, #6 data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp6 &lt;- 3 + 10*x + rnorm(n)\npred6 &lt;- predict(lm(resp6 ~ x), data.frame(x))\n\n\n#running base functions to get the correct values\ngetRMSE(resp6, pred6)\n\n[1] 0.9581677\n\ngetMAE(resp6, pred6)\n\n[1] 9.636992e-16\n\n\n\n#running the wrapper function \nstat_wrapper(resp6, pred6)\n\n$RMSE\n[1] 0.9581677\n\n$MAE\n[1] 9.636992e-16\n\n\n\n#adding NA values to the data\nresp6[22:23] &lt;- NA_real_\n\n#running the wrapper function without specifying NA values\nstat_wrapper(resp6, pred6)\n\n$RMSE\n[1] NA\n\n$MAE\n[1] NA\n\n#testing the additional arguments by specifying the NA values \nstat_wrapper(resp6, pred6, na.rm = TRUE)\n\n$RMSE\n[1] 0.946897\n\n$MAE\n[1] 0.028468\n\n\n\n#testing with incorrect data type \nstat_wrapper(iris)\n\nError in stat_wrapper(iris): Response variable is invalid\n\n\n\n\nTask 3: Querying an API and a Tidy-Style Function\n\n#adding hidden api key file\napi_key &lt;- source(\"api_key.R\")\n\n\n#grabbing some articles using personal API key\nbio_api &lt;- httr::GET(\"https://newsapi.org/v2/everything?q=biofuel\", \n                     add_headers(Authorization = (api_key$value)))\n\n\n#parsing the API info\nbio_parsed &lt;- bio_api$content |&gt;\n  rawToChar() |&gt;\n  fromJSON()\nstr(bio_parsed, max.level = 1)\n\nList of 3\n $ status      : chr \"ok\"\n $ totalResults: int 303\n $ articles    :'data.frame':   100 obs. of  8 variables:\n\n\n\n#turning the dataframe into a tibble \nbio_info &lt;- bio_parsed$articles |&gt;\n  as_tibble()\nbio_info\n\n# A tibble: 100 × 8\n   source$id $name author title description url   urlToImage publishedAt content\n   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 new-scie… New … James… Ship… \"Cashew nu… http… https://i… 2024-06-17… \"Cashe…\n 2 &lt;NA&gt;      Scie… &lt;NA&gt;   Sky'… \"The Unite… http… https://w… 2024-06-07… \"The U…\n 3 &lt;NA&gt;      Read… Suswa… Smar… \"Scientist… http… https://r… 2024-06-06… \"Scien…\n 4 abc-news  ABC … PATRI… Main… \"Represent… http… https://i… 2024-06-04… \"PORTL…\n 5 &lt;NA&gt;      Auto… Jonat… It's… \"Filed und… http… https://s… 2024-06-27… \"Last …\n 6 &lt;NA&gt;      Phys… April… Fine… \"Sugarcane… http… https://s… 2024-06-10… \"This …\n 7 &lt;NA&gt;      Phys… DORAN… Conv… \"The stenc… http… https://s… 2024-06-14… \"This …\n 8 &lt;NA&gt;      Scie… &lt;NA&gt;   Fine… \"A CABBI r… http… https://w… 2024-06-10… \"Sugar…\n 9 &lt;NA&gt;      Thea… Elia … Norw… \"Exploring… http… https://t… 2024-06-17… \"A Roy…\n10 &lt;NA&gt;      Scie… &lt;NA&gt;   Risk… \"The Swedi… http… https://w… 2024-05-29… \"The S…\n# ℹ 90 more rows\n\n\n\nnews_articles &lt;- function(subject, time_frame_start, time_frame_end, key = api_key$value){\n  URL &lt;- paste(\"https://newsapi.org/v2/everything?\",\n               subject,\n               \"&from=\",\n               time_frame_start,\n               \"&to=\",\n               time_frame_end,\n               \"&language=en&apiKey=\", \n               key, \n               sep = \"\")\n  temp_api &lt;- GET(URL)\n  \n  temp_parse &lt;- temp_api$content |&gt;\n    rawToChar() |&gt;\n    fromJSON() |&gt;\n    as_tibble()\n  return(temp_parse)\n}\n\n\nnews_articles(\"biofuel\", \"2024-06-29\", \"2024-01-01\")\n\n# A tibble: 1 × 3\n  status code              message                                              \n  &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt;                                                \n1 error  parametersMissing Required parameters are missing, the scope of your s…\n\nnews_articles(\"apple\", \"2024-06-29\", \"2024-01-01\")\n\n# A tibble: 1 × 3\n  status code              message                                              \n  &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt;                                                \n1 error  parametersMissing Required parameters are missing, the scope of your s…\n\n\n\nI am not sure why the request isn’t working in this case."
  }
]